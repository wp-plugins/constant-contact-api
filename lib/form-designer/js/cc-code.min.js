function triggerTextUpdate(e){if(jQuery(".kws_form .cc_intro").length>0){var t=tinyMCE.activeEditor,o=t.getContent({format:"raw"});jQuery(".kws_form .cc_intro").html(o)}}function empty(e){var t;if(0===e||"0"===e)return!1;if(""===e||null===e||e===!1||"false"===e||"undefined"==typeof e)return!0;if("object"==typeof e){for(t in e)return!1;return!0}return!1}jQuery.noConflict(),kwsdebug=empty(ScriptParams.debug),jQuery(document).ready(function($){function e(e,t,o,a,i){var r=$('label[for="'+e.replace("#","")+'"] tt');kwsdebug&&console.log(e+"-slider",e,t,o,a,i),$(e+"-slider").slider({min:o,max:a,step:i,value:$(e).val(),slide:function(e,o){r.text(o.value+"px"),$("#examplewrapper .kws_form").attr("style",t+":"+o.value+"px!important;")},stop:function(t,o){$(e).val(o.value).trigger("change")}})}function t(){return $("#toggledesign").is(":checked")}function o(e){$designdivs=$("#designoptions,#backgroundoptions,#border,#fontstyles,#formdesign,.grabber,#examplewrapper,.labelStyle.mce_bold,.labelStyle.mce_italic"),$(".safesubscribesample").css("background","transparent none"),t()?($designdivs.show(),empty(e)&&i()):$designdivs.hide()}function a(e){var t="";empty(e)&&($("ul#patternList li.selected").length>0?(e=$("ul#patternList li.selected"),t=e.attr("title")):(t=$("#patternurl").val(),empty(t)&&(t=$("#bgpattern ul li.selected").length>0?$("#bgpattern ul li.selected").attr("title"):$("#bgpattern ul li:first").attr("title")),e=$('ul#patternList li[title*="'+t+'"]'))),$("ul#patternList li").removeClass("selected"),e.addClass("selected");var o=e.attr("title");$("#patternurl").val(o),k(ScriptParams.path+o)}function i(e){if(kwsdebug&&console.log("generateForm",e),$("ul.menu li.formfield").each(function(){$("input,textarea",$(this)).attr("disabled",!0)}),$("#formfields_select input[type=checkbox]:checked").each(function(){$("input,textarea",$("ul.menu li.formfield").has("input#"+$(this).val())).removeAttr("disabled")}),t()&&!$("#togglePreview").is(".hidden")){var o=Date.now(),a=ScriptParams.rand+$("#cc-form-id").val()+o,i={rand:ScriptParams.rand,form:$("form#cc-form-settings").serializeArray(),verify:a,date:o,text:ScriptParams.text,path:ScriptParams.path},r=(new Date).getTime();return kwsdebug&&console.log(i),$.ajax({type:"POST",url:ajaxurl,processData:!1,isLocal:!0,dataType:"json",data:"action=ctct_form_designer&data="+encodeURIComponent(JSON.stringify(i)),success:function(e,t,o){if(e){var a=!1,i=!1,r=!1,l=!1;if("string"==typeof e&&(e=jQuery.parseJSON(e)),kwsdebug&&console.log("AJAX Data Response",e),empty(e.pre)||$("body").prepend(e.pre),!empty(e.form)){a=e.css+e.form;var n="",c=$(".list-selection-format input:checked").val();switch(c){case"checkbox":$(".ctct-lists li").has("input:checked").each(function(){checked=$("#checked_by_default").is(":checked")?' checked="checked"':"",n=n+'<li><label><input type="checkbox" '+checked+" /> "+$("span",$(this)).html()+"</label></li>"}),n='<ul class="checkboxes">'+n+"</ul>";break;case"dropdown":case"multiselect":$(".ctct-lists li").has("input:checked").each(function(){n=n+"<option>"+$("span",$(this)).text()+"</option>"}),n="multiselect"===c?'<select class="kws_clear" multiple="multiple">'+n+"</select>":'<select class="kws_clear">'+n+"</select>"}a=a.replace("<!-- %%LISTSELECTION%% -->",n),a=a.replace('action="<!-- %%ACTION%% -->"','onsubmit="return false;"'),$(".grabber .kws_form, .grabber style").remove(),$(".grabber").append(a),empty(n)&&$(".grabber .cc_lists").hide()}}},error:function(e,t,o){return kwsdebug&&console.log(e,t,o),$(".grabber").css("width","50%").css("margin","0 auto").css("text-align","left").html("<h2><em>Eeep! That didn't work...</em></h2><h3>The error: <code>"+o+"</code></h3>"),!1}}).done(function(e,t,o){var a=(new Date).getTime()-r;kwsdebug&&console.log("request took %s milliseconds.",a,o)}),!1}}function r(e){var t=e.keyCode?e.keyCode:e.which;return 37===t||38===t||39===t||40===t||46===t||8===t||16===t?!1:!0}function l(){if("px"===$("input[name=widthtype]:checked").val()){var e=2*$("#borderwidth").val(),t=2*$("#paddingwidth").val(),o=$("#width").val(),a=Math.floor(o)-Math.floor(t)-Math.floor(e),i=Math.floor(o)+Math.floor(t)+Math.floor(e);$("label[for=width] span.ctct_tip").attr("title","<p><strong>Actual width is "+i+"px.</strong> <em>For an form that is "+o+"px wide, set Form Width to "+a+"px</em></p>").tooltip()}else $("label[for=width] span.ctct_tip").attr("title","<p><strong>Width depends on the size of the container.</strong> For example, for a form in a sidebar, the form's width percentage will be based on the width of the sidebar.</p>")}function n(e,t){return $input_a=$("input.position",$(e)).val(),$input_b=$("input.position",$(t)).val(),0===$input_a.length||0===$input_b.length?0:$input_a>$input_b?1:-1}function c(){$("#form-fields ul.menu li.menu-item").sort(n).appendTo("#form-fields ul.menu")}function s(e){e?kwsdebug&&console.log(e):e=$("#formfields_select input:checkbox"),e.each(function(){var t=$("#form-fields .menu li").has("#"+$(this).val()),o=$(this).checked||$(this).prop("checked")||$(this).is(":checked");empty(o)?("intro"===e.val()&&$(".wp-editor-textarea").hide(),t.hide().find("input.checkbox").prop("checked",o).find("input,textarea").each(function(){$(this).attr("disabled",!0)})):("intro"===e.val()&&$(".wp-editor-textarea").show(),t.remove().appendTo($("#form-fields .menu")).show(),t.find("input,textarea").each(function(){$(this).removeAttr("disabled")}).find("input.checkbox").prop("checked",o))})}function p(e){kwsdebug&&console.log("updateFormFields",e),$(".wp-editor-textarea,ul.menu li.formfield").each(function(){d($(this))}),i("updateFormFields")}function d(e){e.not("li")&&(e=e.parents("li.formfield"));var t=$("input.checkbox",e);if(t.is(":checked")){if($(".menu-item-settings",e).show(),check={},check.id=t.attr("id"),check.val=t.val(),check.name=t.attr("name"),check.rel=t.attr("rel"),input={},input.textarea="",input.label="",input.value="",input.html="",input.bold="",input.italic="",input.required="",input.labelHTML="",input.size=$("input.labelSize",e).val(),kwsdebug&&console.log("check: %s, input: %s",check,input),$("input.labelValue",e).length>0){var o=$("input.labelValue",e);input.label=o.val()}("textarea"===check.rel||e.hasClass("wp-editor")||$("textarea.labelValue",e).length>0||$("body.mceContentBody",e).length>0)&&(input.textarea=!0),e.addClass("checked").addClass("ui-state-active"),$("input.labelDefault",e).length>0?input.value=$("input.labelDefault",e).val():empty(tinyMCE)&&(input.value=$("textarea.labelDefault",e).html()),$("#"+check.id+"_bold").is(":checked")&&(input.bold=!0),$("#"+check.id+"_italic").is(":checked")&&(input.italic=!0),$("#"+check.id+"_required").is(":checked")&&(input.required=!0),"text"===check.rel&&(input.html='<input type="text" value="'+input.value+'" size="'+input.size+'" name="'+check.name+'" class="text" id="cc_'+check.id+'" />'),("button"===check.rel||"submit"===check.rel)&&(input.html='<input type="submit" value="'+input.value+'" name="'+check.name+'" id="cc_'+check.id+'" />'),"textarea"===check.rel&&(input.html=$("<textarea>"+input.value+"</textarea>").attr("name",check.name).attr("id",check.id).removeAttr("disabled"))}else e.removeClass("checked").removeClass("ui-state-active")}function u(){$("ul.menu li.formfield").each(function(){$("input.position[type=hidden]",$(this)).val($("ul.menu li.formfield input.position").index($("input.position",$(this))))})}function g(e){var t;prev=e.placeholder.prev(),next=e.placeholder.next(),prev[0]===e.item[0]&&(prev=prev.prev()),next[0]===e.item[0]&&(next=next.next())}function h(e,t,o,a,i){e||(e=$('input[name="lfont"]').val()),t||(t=$('input[name="lsize"]').val()),o||(o=""),a||(a=$('input[name="lpad"]').val()),i||(i=$('input[name="lalign"]').val()),m(e,t,o,a,i,"l")}function m(e,t,o,a,i,r){kwsdebug&&console.log("updateTextStyle",e,t,o,a,i,r),empty(r)&&(r="t"),empty(e)?e=$("#"+r+"font").val():(e=$('select[name="'+r+'font"] option[id="'+e+'"]').val(),$('select[name="'+r+'font"] option[value="'+e+'"]').prop("selected",!0)),empty(t)?t=$("#"+r+"size").val():$("select#"+r+'size option[value="'+t+'"]').prop("selected",!0),empty(i)&&(i=$('input[name="'+r+'align"]').val()),empty(o)?o=$('input[name="'+r+'weight"]').val():$('input[name="'+r+'weight"][value="'+o+'"]').prop("checked",!0),$('#textfont option:selected:contains("*")').length>0?$("#"+r+"options .asterix").show():$("#"+r+"options .asterix").hide()}function b(e){empty(e)||$("#borderwidth").val(e),e=$("#borderwidth").val(),empty(e)?$("#bordercoloritem").hide():$("#bordercoloritem").show(),$(".kws_form").css({"border-width":e+"px"})}function f(e){kwsdebug&&console.log("updateBackgroundType"+e),color1=$("#color6").wpColorPicker("color"),color2=$("#color2").wpColorPicker("color"),gradtype=$("#gradtype").val();var t=$("input[name=backgroundtype]:checked").val();"transparent"===t?($("#bgtop,#bgbottom,#gradtype,#bgrepeat,#bgpos,#bgpattern,#patternurl,#bgurl,#color2,#gradheightli,#gradtypeli").attr("disabled",!0).hide(),$(".safesubscribesample").css("background","none transparent")):"gradient"===t?($("#bgtop,#bgbottom,#gradtype,#bgrepeat,#bgpos,#bgpattern,#patternurl,#bgurl,#color2,#gradheightli,#gradtypeli").attr("disabled",!1).show(),$("#bgpattern,#bgurl").hide(),$("#patternurl,#bgimage").attr("disabled",!0),$("#color2,#gradtype,#bgrepeat,#bgpos").removeAttr("disabled"),P("#color6",color1),P("#color2",color2),$(".safesubscribesample").css("background",color1+" none"),"vertical"===$("#gradtype").val()?($("#bgbottom label").text(ScriptParams.labels.bottomcolor+":"),$("#bgtop label").text(ScriptParams.labels.topcolor+":"),$("#gradheightli label span").text(ScriptParams.labels.gradientheight+":"),$(".kws_form").css({background:color1,background:"-moz-linear-gradient(top, "+color1+" 0%, "+color2+" 100%)",background:"-webkit-gradient(linear, left top, left bottom, color-stop(0%,"+color1+"), color-stop(100%,"+color2+"))",background:"-webkit-linear-gradient(top, "+color1+" 0%,"+color2+" 100%)",background:"-o-linear-gradient(top, "+color1+" 0%,"+color2+" 100%)",background:"-ms-linear-gradient(top, "+color1+" 0%,"+color2+" 100%)",background:"linear-gradient(to bottom, "+color1+" 0%,"+color2+" 100%)",filter:"progid:DXImageTransform.Microsoft.gradient( startColorstr='"+color1+"', endColorstr='"+color2+"',GradientType=0 )"})):($("#bgbottom label").text(ScriptParams.labels.rightcolor+":"),$("#bgtop label").text(ScriptParams.labels.leftcolor+":"),$("#gradheightli label span").text(ScriptParams.labels.gradientwidth+":"),$(".kws_form").css({background:color1,background:"-moz-linear-gradient(left,  "+color1+" 0%, "+color2+" 100%)",background:"-webkit-gradient(linear, left top, right top, color-stop(0%,"+color1+"), color-stop(100%,"+color2+"))",background:"-webkit-linear-gradient(left,  "+color1+" 0%,"+color2+" 100%)",background:"-o-linear-gradient(left, "+color1+" 0%,"+color2+" 100%)",background:"-ms-linear-gradient(left, "+color1+" 0%,"+color2+" 100%)",background:"linear-gradient(to right,  "+color1+" 0%, "+color2+" 100%)",filter:"progid:DXImageTransform.Microsoft.gradient( startColorstr='"+color1+"', endColorstr='"+color2+"',GradientType=1 )"}))):"solid"===t?($("#bgtop,#gradheightli,#gradtypeli,#bgpattern,#bgurl").hide(),$("#bgbottom").show(),$("#bgbottom label").text(ScriptParams.labels.bgcolor+":"),$("#patternurl,#bgimage,#gradtype,#bgrepeat,#bgpos").attr("disabled",!0),$("#color2").removeAttr("disabled"),P("#color6",color1),P("#color2",color2),$(".kws_form,.safesubscribesample").css("background-color",color2).css("background-image","none")):"pattern"===t?($("#bgtop,#gradheightli,#gradtypeli,#bgbottom,#bgurl").hide(),$("#bgpattern").show(),$("#color2,#bgimage").attr("disabled",!0),$("#bgpattern,#patternurl,#bgrepeat,#bgpos").removeAttr("disabled"),a()):"url"===t&&($("#patternurl").attr("disabled",!0),$("#color2,#bgimage,#bgrepeat,#bgpos").removeAttr("disabled"),$("#bgtop,#gradheightli,#bgpattern").hide(),$("#bgurl,#bgbottom").show(),$("#bgbottom label").text(ScriptParams.labels.bgcolor+":"),k())}function k(e,t,o,a){empty(o)&&(o=$("#bgrepeat").val()),empty(e)&&(e=$("input#bgimage").val()),e=""===e||"http://"===e?"":"url("+e+")",empty(t)&&(t=$("#color2").wpColorPicker("color")),empty(a)&&(a=$("#bgpos").val()),$(".kws_form,.safesubscribesample").css("background",t+" "+e+" "+a+" "+o)}function w(e){kwsdebug&&console.log("updateLabelStame",e),e?$("input#lusc").prop("checked",!0):e===!1&&$("input#lusc").prop("checked",!1),$("input#lusc").is(":checked")?($("#labelcolorli").hide(),$("#labelcolorli input").attr("disabled",!0)):($("#labelcolorli").show(),$("#labelcolorli input").removeAttr("disabled")),$("input#lusf").is(":checked")?($("#lfontli").hide(),$("#lfont").val($("#tfont").val())):$("#lfontli").show()}function v(e){kwsdebug&&console.log("updateLabelColor",e),e||(e=$("#lcolor").wpColorPicker("color")),P("#lcolor",e,".kws_form .kws_input_container label","color")}function y(e){kwsdebug&&console.log("updateTextColor: "+e),e||(e=$("#tcolor").wpColorPicker("color")),P("#tcolor",e,".kws_form .cc_intro,.kws_form .cc_intro *","color"),$("#lusc").is(":checked")&&v(e)}function x(e){kwsdebug&&console.log("updateBorderColor",e),empty(e)&&(e=$("#bordercolor").wpColorPicker("color")),P("#bordercolor",e,".kws_form","border-color")}function P(e,t,o,a){kwsdebug&&console.log("updateColor",e,t,o,a),$(e).val(t),a&&$(o).css(a,t)}function C(){kwsdebug&&console.log("updateStyle"),f("updateStyle"),m(),h(),w(),$("label.labelStyle").trigger("ready")}$("a[rel*=external]").attr("target","_blank"),$("input.wpcolor").wpColorPicker({palettes:!1,change:function(e,t){kwsdebug&&console.log("wpColorPicker Change",e),$(this).data("doingchange",1),$(this).trigger("colorchange"),$(this).data("doingchange",null)}}),$("#tabs,#formfields-select-tabs").tabs({cookie:{expires:60}}).addClass("ui-helper-clearfix"),$("#tabs li").removeClass("ui-corner-top").addClass("ui-corner-left"),$("#tabs li li").removeClass("ui-corner-left"),$("input.menu-item-checkbox[value=intro]").is(":checked")&&$(".wp-editor-textarea").show(),e("#borderwidth","border-width",0,50,1),e("#borderradius","border-radius",0,100,5),e("#paddingwidth","padding",0,100,5),$("body").on("click",".selectall, .selectall input",function(){$(this).select()}).on("ready change","#toggledesign",function(e){console.log("toggledesign change"),e.stopImmediatePropagation(),o()}).on("change",'input:checkbox[name^="formfields"]',function(e){e.stopImmediatePropagation(),s($(this)),u(),p("change name formfields"),$("textarea.wp-editor").trigger("change")}).on("change","input[name=list_format]",function(e){e.stopImmediatePropagation();var t=$(this).val(),o="checked";switch(t){case"hidden":o=null}$('input[name="formfields[lists]"]').attr("checked",o).trigger("change")}).on("change",'input:checkbox[name^="f"]',function(e){e.stopImmediatePropagation(),u(),p("input:checkbox[f] bind")}).on("sortstop","#form-fields ul.menu",function(e){e.stopImmediatePropagation(),u(),p("formfields drop")}).on("change keyup","input#bgimage",function(e){e.stopImmediatePropagation(),k()}).on("change","#form-fields input.labelValue,#form-fields input.labelDefault",function(e){e.stopImmediatePropagation(),p("labelDefault change keyup")}).on("click","li.menu-item .item-edit",function(e){return e.preventDefault(),$(".menu-item-settings",$(this).parents("li.formfield")).toggle(),!1}).on("change","input,select",function(){$("#cc-form-settings").trigger("stylechange")}).on("click","#togglePreview",function(e){return $("#togglePreview").toggleClass("hidden"),$("#examplewrapper .grabber").toggle(0,function(){$("#examplewrapper .grabber").is(":visible")?($("#examplewrapper .legend").show(),$(window).trigger("resize")):($("#examplewrapper .legend").hide(),$("#examplewrapper").css({width:"0","min-width":"200px"}))}),!1}).on("change","#borderwidth",function(e){kwsdebug&&console.log("#borderwidth change"),e.stopImmediatePropagation(),l(),b(),$(window).trigger("resize")}).on("change",'#tfont,#tsize,input[name="talign"]',function(e){kwsdebug&&console.log('#tfont,#tsize,input[name="talign"] change'),e.stopImmediatePropagation(),C()}).on("change",'#lfont,#lsize,input[name="lalign"]',function(e){kwsdebug&&console.log('#lfont,#lsize,input[name="lalign"] change'),e.stopImmediatePropagation(),h()}).on("change","#gradtype",function(e){e.stopImmediatePropagation(),f("gradtype")}).on("colorchange","#color6,#color2",function(e){e.stopImmediatePropagation(),f("color6 or color2")}).on("colorchange","#bordercolor",function(e){e.stopImmediatePropagation(),x()}).on("colorchange","#tcolor",function(e){e.stopImmediatePropagation(),y()}).on("colorchange","#lcolor",function(e){e.stopImmediatePropagation(),v()}).on("change","#bgpos,#bgrepeat",function(e){e.stopImmediatePropagation(),k()}).on("change",'input[name="backgroundtype"]',function(e){e.stopImmediatePropagation(),f("backgroundtype")}).on("change","input[id^=lus]",function(e){e.stopImmediatePropagation(),w()}).on("click ready","label.labelStyle",function(e){e.stopImmediatePropagation(),$("input[type=checkbox]:checked",$(this)).length>0?$(this).addClass("checked"):$(this).removeClass("checked")}).on("click","ul#patternList li",function(e){e.stopImmediatePropagation(),a($(this))}).on("change","input[name=widthtype]",function(e){if("per"===$("input[name=widthtype]").val())1*$("#width").val()>100&&($("#width").attr("data-px",$("#width").val()),$("#width").val(100));else{var t=$("#width").attr("data-px");empty(t)||($("#width").val(t),$("#width").attr("data-px",null))}}).on("change keyup","#paddingwidth,input[name=widthtype],#width",function(e){e.stopImmediatePropagation(),(r(e)||46===e.keyCode||8===e.keyCode)&&l()}).on("stylechange","#cc-form-settings",function(e){e.stopImmediatePropagation(),i("stylechange triggered by "+$(e.target).attr("id"))}).on("change","#cc-form-settings input:not(.inside input), #cc-form-settings textarea:not(.inside textarea), #cc-form-settings select",function(e){kwsdebug&&console.log("Changed settings input",e),e.stopImmediatePropagation(),i("#cc-form-settings style - "+$(this).attr("id"))}).on("click","label img",function(){$(this).closest("input[type=radio]").click()}).on("click","a.toggleMore",function(){$(this).parents("ul").find(".toggleMore:not(a):not(:has(input[type=checkbox]:checked))").toggle("fast");var e=$(this).text(),t=e.replace(ScriptParams.labels.show,ScriptParams.labels.hide);return $(this).text(t===e?e.replace(ScriptParams.labels.hide,ScriptParams.labels.show):t),!1}),$("#form-fields ul.menu").sortable({handle:".menu-item-handle",forceHelperSize:!0,placeholder:"sortable-placeholder",start:function(e,t){g(t),$(this).disableSelection(),$("body,#menu-to-edit").disableSelection()},change:function(e,t){t.placeholder.parent().hasClass("menu")||(prev.length?prev.after(t.placeholder):api.menuList.prepend(t.placeholder)),g(t)},update:function(e,t){},sort:function(e,t){g(t)},stop:function(e,t){$("body,#menu-to-edit").enableSelection(),$(this).enableSelection(),i(!0,!1,".sortable"),$("textarea",$(this)).removeAttr("disabled")}}),$(".nav-tab-link").click(function(){return panelId=/#(.*)$/.exec($(this).attr("href")),panelId&&panelId[1]?(panelId=panelId[1],wrapper=$(this).parents(".inside").first(),$(".tabs-panel-active",wrapper).removeClass("tabs-panel-active").addClass("tabs-panel-inactive"),$("#"+panelId,wrapper).removeClass("tabs-panel-inactive").addClass("tabs-panel-active"),$(".tabs",wrapper).removeClass("tabs"),$(this).parent().addClass("tabs"),!1):!1}),o(!0),C(),s(),c(),p("updateAll"),$("form label.error").hide(),$(window).on("ready resize",function(){if(!$("#examplewrapper .grabber").is(":hidden")){box=jQuery("#menu-management-liquid .menu-edit").width(),menu=jQuery("#menu-to-edit").width(),available=box-menu;var e=null;if("px"===$("input[name=widthtype]:checked").val()){var t=2*$("#borderwidth").val(),o=2*$("#paddingwidth").val(),a=$("#width").val(),i=Math.floor(a)-Math.floor(o)-Math.floor(t);e=Math.floor(a)+Math.floor(o)+Math.floor(t)}jQuery("#examplewrapper").width(available-60).css("min-width",e)}}).trigger("resize"),jQuery(".toggleMore:not(a)").hide()});