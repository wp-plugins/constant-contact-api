!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function($){var e=".inlineedit",t="inlineEdit-placeholder",n=["click","mouseenter","mouseleave"].join(e+" ");$.fn.inlineEdit=function(e){function t(t){var n=$.inlineEdit.getInstance(this,e),i=n.element.find(n.options.control),l=!!i.length;if(n.element.removeClass(n.options.hover),i[0]!=t.target&&0==i.has(t.target).length)switch(t.type){case"click":n[l?"mutate":"init"]();break;case"mouseover":case"mouseout":case"mouseenter":case"mouseleave":l||n.hoverClassChange(t)}}this.each(function(){$.inlineEdit.getInstance(this,e).initValue()});var i=function(e){t.apply(this,[e])};$.fn.on?$(this.context).on(n,this.selector,i):$(this).live(n,i)},$.inlineEdit=function(e,t){this.options=$.extend(!0,{},$.inlineEdit.defaults,t),this.element=$(e)},$.inlineEdit.getInstance=function(t,n){return $.inlineEdit.initialised(t)?$(t).data("widget"+e):new $.inlineEdit(t,n)},$.inlineEdit.initialised=function(t){var n=$(t).data("init"+e);return void 0!==n&&null!==n?!0:!1},$.inlineEdit.defaults={hover:"ui-state-hover",editInProgress:"edit-in-progress",value:"",save:"",cancel:"",buttons:'<button class="save">save</button> <button class="cancel">cancel</button>',placeholder:"Click to edit",control:"input",cancelOnBlur:!1,saveOnBlur:!1,nl2br:!0,debug:!1,mutate:""},$.inlineEdit.prototype={init:function(){this.element.data("init"+e,!0),this.initValue(),this.mutate(),this.element.data("widget"+e,this)},initValue:function(){this.value($.trim(this.element.data("original-content")||this.element.html())||this.options.value),this.value()?this.options.value&&this.element.html(this.options.value):this.element.html($(this.placeholderHtml()))},mutate:function(){var e=this;return e.prevValue(e.element.html()),e.element.html(e.mutatedHtml(e.value())).addClass(e.options.editInProgress).find(".save").bind("click",function(t){return e.save(e.element,t),e.change(e.element,t),!1}).end().find(".cancel").bind("click",function(t){return e.cancel(e.element,t),e.change(e.element,t),!1}).end().find(e.options.control).bind("blur",function(t){e.options.cancelOnBlur===!0?(e.cancel(e.element,t),e.change(e.element,t)):1==e.options.saveOnBlur&&(e.save(e.element,t),e.change(e.element,t))}).bind("keyup",function(t){switch(t.keyCode){case 13:"textarea"!==e.options.control&&(e.save(e.element,t),e.change(e.element,t));break;case 27:e.cancel(e.element,t),e.change(e.element,t)}}).focus().end(),this._callback("mutate",[event,this])&&this._debug("mutate:","Current stored value",this.value()),this},value:function(t){if(arguments.length){var n=t==this.placeholderHtml()?"":t;this._debug("value:","to save",n),this.element.data("value"+e,n&&this.encodeHtml(this.nl2br(n))),this._debug("value:","saved",this.element.data("value"+e))}return this._decodeHtml(this.element.data("value"+e))},prevValue:function(t){if(arguments.length){var n=t===this.options.placeholder?"":t;this.element.data("prev_value"+e,n)}return this.element.data("prev_value"+e)},mutatedHtml:function(e){return this.controls[this.options.control].call(this,e)},placeholderHtml:function(){return'<span class="'+t+'">'+this.options.placeholder+"</span>"},buttonHtml:function(e){var t=$.extend({},{before:" ",buttons:this.options.buttons,after:""},e);return t.before+t.buttons+t.after},save:function(e,t){var n=this.element.find(this.options.control),i={value:this.encodeHtml(n.val())};this._debug("save:","Saving..."),n.val(i.value),this._callback("save",[t,i,this])&&(this.value(i.value),this._debug("save:","Current stored value",this.value()))},cancel:function(e,t){var n=this.element.find(this.options.control),i={value:this.encodeHtml(n.val())};this._debug("cancel:","Cancelling..."),this._callback("cancel",[t,i,this])&&(this.value(this.prevValue()),this._debug("cancel:","Current stored value",this.value()))},change:function(e,t){var n=this;this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){n._debug("change:","Change",n.value()),n.element.html(n.value()||n.placeholderHtml()),n.element.removeClass(n.options.hover),n.element.removeClass(n.options.editInProgress),n._callback("change",[t,n]),n._debug("change:","Change complete")},200)},controls:{textarea:function(e){return"<textarea>"+this.br2nl(e)+"</textarea>"+this.buttonHtml({before:"<br />"})},input:function(e){return'<input type="text" value="'+e.replace(/(\u0022)+/g,"")+'"/>'+this.buttonHtml()}},hoverClassChange:function(e){$(this.element)[/mouseover|mouseenter/.test(e.type)?"addClass":"removeClass"](this.options.hover)},encodeHtml:function(e){var t=[{key:/</g,value:"<"},{key:/>/g,value:">"},{key:/"/g,value:"&quot;"}],n=e;return $.each(t,function(e,t){n=n.replace(t.key,t.value)}),n},br2nl:function(e){return this.options.nl2br?e.replace(/<br\s?\/?>/g,"\n"):e},nl2br:function(e){return this.options.nl2br?e.replace(/\n/g,"<br />"):e},_debug:function(){return this.options&&this.options.debug?window.console&&console.log.call(console,arguments):void 0},_callback:function(e,t){return($.isFunction(this.options[e])&&this.options[e].apply(this.element[0],t))!==!1||!this.options[e]},_decodeHtml:function(e){var t=e.replace(/&quot;/g,'"');return this._debug("_decodeHtml:",t),t}}});